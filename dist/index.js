ðŸ“¦
2198 /src/index.js
âœ„
var p;(function(d){class n{static enabled=!0;static setEnabled(t){n.enabled=t}static print(t,i,o){n.enabled&&(console[t]??console.log)(`[${i}]`,...o)}static info(...t){n.print("log","INFO",t)}static debug(...t){n.print("log","DEBUG",t)}static warn(...t){n.print("warn","WARN",t)}static error(...t){n.print("error","ERROR",t)}}function u(e){try{return Java.use(e)}catch{return n.info("Can't find class: "+e),null}}function f(e,t){if(!e){n.warn("Register method hook, method is null");return}try{e.implementation=function(...i){try{t.onEnter?.call(this,i)}catch(c){n.warn("JavaMethodHook onEnter error: "+c)}let o,r;try{o=e.apply(this,i)}catch(c){r=c}try{t.onLeave?.call(this,i,o)}catch(c){n.warn("JavaMethodHook onLeave error: "+c)}if(r)throw r;return o}}catch(i){n.warn(`Register method(${e}) hook error: ${i}`)}}function h(e,t){let i=s=>{let l=s.getPackageName(),a=s.getPackageManager().getLaunchIntentForPackage(l);return a?a.getComponent()?.getClassName():null},o=s=>{let l=s.getPackageName(),a=s.getPackageManager().getPackageInfo(l,1).activities;return a&&a.value&&a.value.length>0?a.value[0].name.value:null},r=u(e);if(!r){t?.onError?.("Can't find application class: "+e);return}let c=s=>{f(r.onCreate,{onEnter:function(){u(s)!=null?t?.onUnpacked?.():t?.onError?.("Shell not unpacked yet in Application.onCreate")}})};f(r.attachBaseContext,{onEnter:function(s){this.isPacked=!1;let l=s[0],a=i(l);if(a||(a=o(l)),!a){t?.onError?.("Can't find any activity class");return}this.testActivityClassName=a,n.debug(`Test activity: ${a}`),u(a)==null?(this.isPacked=!0,t?.onDetected?.(!0)):t?.onDetected?.(!1)},onLeave:function(){this.isPacked&&(u(this.testActivityClassName)!=null?t?.onUnpacked?.():c(this.testActivityClassName))}})}function v(e){Java.perform(function(){let t=u("android.app.LoadedApk");if(!t){e?.onError?.("Can't find class: android.app.LoadedApk");return}f(t.makeApplication,{onEnter:function(i){if(i[1]!=null)return;let o=this.getApplicationInfo();if(o.className==null)e?.onDetected?.(!1);else{let r=o.className.value;if(!r){e?.onError?.("Application class is null");return}n.info("Application class name: "+r),h(r,e)}}})})}d.register=v})(p||(p={}));export{p as FridaShellDetector};
